

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Controlling Syntax Coloring &mdash; Leo v4.9 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '4.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <link rel="top" title="Leo v4.9 documentation" href="index.html" />
    <link rel="next" title="Creating Documents with Leo" href="rstplugin3.html" />
    <link rel="prev" title="Customizing Leo" href="customizing.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="rstplugin3.html" title="Creating Documents with Leo"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="customizing.html" title="Customizing Leo"
             accesskey="P">previous</a> |</li>
        <li><a href="leo_toc.html">Leo v4.9 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="controlling-syntax-coloring">
<h1><a class="toc-backref" href="#id1">Controlling Syntax Coloring</a><a class="headerlink" href="#controlling-syntax-coloring" title="Permalink to this headline">¶</a></h1>
<p>This chapter discusses the settings to control Leo&#8217;s syntax colorer. This
chapter also discusses how to extend Leo&#8217;s colorizer by creating xml language
descriptions files and corresponding Python files. <strong>Important</strong>: this material
is for those who want to support Leo&#8217;s colorizing code. To use Leo&#8217;s colorizers
you only need to know about syntax-coloring settings.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#controlling-syntax-coloring" id="id1">Controlling Syntax Coloring</a><ul>
<li><a class="reference internal" href="#syntax-coloring-settings" id="id2">Syntax coloring settings</a></li>
<li><a class="reference internal" href="#files" id="id3">Files</a></li>
<li><a class="reference internal" href="#the-colorizer-s-inner-loop" id="id4">The colorizer&#8217;s inner loop</a></li>
<li><a class="reference internal" href="#format-of-colorizer-control-files" id="id5">Format of colorizer control files</a><ul>
<li><a class="reference internal" href="#ruleset-names" id="id6">Ruleset names</a></li>
<li><a class="reference internal" href="#x-properties" id="id7">x.properties</a></li>
<li><a class="reference internal" href="#attribute-dictionaries-and-x-attributesdictdict" id="id8">Attribute dictionaries and x.attributesDictDict</a></li>
<li><a class="reference internal" href="#keyword-dictionaries-and-x-keywordsdictdict" id="id9">Keyword dictionaries and x.keywordsDictDict</a></li>
<li><a class="reference internal" href="#rules-rules-dictionaries-and-x-rulesdictdict" id="id10">Rules, rules dictionaries and x.rulesDictDict</a></li>
<li><a class="reference internal" href="#x-importdict-and-imported-versus-delegated-rulesets" id="id11">x.importDict and imported versus delegated rulesets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rule-methods" id="id12">Rule methods</a><ul>
<li><a class="reference internal" href="#arguments-to-rule-methods" id="id13">Arguments to rule methods</a></li>
<li><a class="reference internal" href="#match-eol-span" id="id14">match_eol_span</a></li>
<li><a class="reference internal" href="#match-eol-span-regexp" id="id15">match_eol_span_regexp</a></li>
<li><a class="reference internal" href="#match-keywords" id="id16">match_keywords</a></li>
<li><a class="reference internal" href="#match-mark-following" id="id17">match_mark_following</a></li>
<li><a class="reference internal" href="#match-mark-previous" id="id18">match_mark_previous</a></li>
<li><a class="reference internal" href="#match-seq" id="id19">match_seq</a></li>
<li><a class="reference internal" href="#match-seq-regexp" id="id20">match_seq_regexp</a></li>
<li><a class="reference internal" href="#match-span" id="id21">match_span</a></li>
<li><a class="reference internal" href="#match-span-regexp" id="id22">match_span_regexp</a></li>
<li><a class="reference internal" href="#match-terminate" id="id23">match_terminate</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="syntax-coloring-settings">
<h2><a class="toc-backref" href="#id2">Syntax coloring settings</a><a class="headerlink" href="#syntax-coloring-settings" title="Permalink to this headline">¶</a></h2>
<p>This section discusses only those settings that affect syntax coloring.
See <a class="reference external" href="customizing.html">Customizing Leo</a> for a general discussion of Leo&#8217;s settings.</p>
<p>Both the old colorizer (in Leo&#8217;s core) and the new colorizer (the
threading_colorizer and qtGui plugins) now support &#64;color and &#64;font settings for colorizing
options. The settings for the old colorizer are:</p>
<div class="highlight-python"><pre>comment_font, cweb_section_name_font, directive_font,
doc_part_font, keyword_font, leo_keyword_font, section_name_font,
section_name_brackets_font, string_font, undefined_section_name_font,
latexBackground_font, and latex_background_font.</pre>
</div>
<p>The settings for the new colorizer are all of the above (except keyword_font) plus the following:</p>
<div class="highlight-python"><pre>comment1_font, comment2_font, comment3_font, comment4_font, function_font,
keyword1_font, keyword2_font, keyword3_font, keyword4_font, label_font,
literal1_font, literal2_font, literal3_font, literal4_font, markup_font,
null_font, and operator_font.</pre>
</div>
<p>To specify a color, say for comment1, for <em>all</em> languages, create an &#64;color node:</p>
<div class="highlight-python"><pre>@color comment1_color = blue</pre>
</div>
<p>To specify a color for a <strong>particular</strong> language, say Python, prepend the setting name
with the language name.  For example:</p>
<div class="highlight-python"><pre>@color python_comment1_color = pink</pre>
</div>
<p>To specify a font, say for keyword_font, to be used as the default font for <strong>all</strong> languages,
put the following in the body text of an &#64;font node in leoSettings.leo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># keyword_font_family = None</span>
<span class="n">keyword_font_size</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">keyword_font_slant</span> <span class="o">=</span> <span class="n">roman</span>
    <span class="c"># roman, italic</span>
<span class="n">keyword_font_weight</span> <span class="o">=</span> <span class="n">bold</span>
    <span class="c"># normal, bold</span>
</pre></div>
</div>
<p>Comments are allowed and undefined settings are set to reasonable defaults.
At present, comments can not follow a setting: comments must start a line.</p>
<p>You can specify per-language settings by preceding the settings names by a prefix x.
Such settings affect only colorizing for language x (i.e., all the modes in modes/x.py when using the new colorizer).
For example, to specify a font for php (only), put the following in the body text of an &#64;font node in leoSettings.leo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># php_keyword_font_family = None</span>
<span class="n">php_keyword_font_size</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">php_keyword_font_slant</span> <span class="o">=</span> <span class="n">roman</span>
    <span class="c"># roman, italic</span>
<span class="n">php_keyword_font_weight</span> <span class="o">=</span> <span class="n">bold</span>
    <span class="c"># normal, bold</span>
</pre></div>
</div>
</div>
<div class="section" id="files">
<h2><a class="toc-backref" href="#id3">Files</a><a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://www.jedit.org/">jEdit</a> editor drives its syntax colorer using xml <strong>language description files.</strong>
Rather than using the xml language description files directly, Leo uses
Python <strong>colorer control files</strong>, created automatically from the xml files by a
script called jEdit2Py.  All these files reside in the leo/modes directory.</p>
<p>These Python files contain all the information in the jEdit&#8217;s xml files, so we
can (loosely) speak of modes, rulesets, rules, properties and attributes in the
Python colorer control files. Later sections of this documentation will make
this loose correspondence exact.</p>
<p><a class="reference external" href="http://www.jedit.org/42docs/users-guide/writing-modes-part.html">jEdit&#8217;s documentation</a> contain a complete description of these xml files.
Each xml file describes one <strong>colorizing mode</strong>.
A mode consists of one or more <strong>rulesets</strong>, and each ruleset consists of a list of <strong>colorizing rules</strong>.
In addition, modes, rulesets and rules may have associated <strong>properties</strong> and <strong>attributes</strong>.
Various rules may specify that the colorizer uses another ruleset (either in the same mode or another mode).</p>
<p><strong>Important</strong>: jEdit&#8217;s xml language description files contain no explicit &lt;RULE&gt; elements
Rules are simply sub-elements of an enclosing &lt;RULES&gt; element.
The element indicates the kind of rule that is specified,
for example, &lt;SPAN&gt;, &lt;SEQ&gt;, etc.
By the term <strong>rule element</strong> we shall mean any sub-element of the &lt;RULES&gt; element.</p>
<p><strong>Important</strong>: throughout this documentation,
<strong>x.py</strong> will refer to the Python colorer for language x,
and <strong>x.xml</strong> will refer to the corresponding xml language-description file.</p>
<p>Using Python colorer control files has the following advantages:</p>
<ul class="simple">
<li>Running jEdit2Py need only be done when x.xml changes,
and the speed of the xml parser in jEdit2Py does not affect the speed of Leo&#8217;s colorizer in any way.
Moreover, the jEdit2Py script can contain debugging traces and checks.</li>
<li>Colorer control files are valid .py files, so all of Python&#8217;s import optimizations work as usual.
In particular, all the data in colorer control files is immediately accessible to Leo&#8217;s colorer.</li>
<li>Colorer control files are easier for humans to understand and modify than the equivalent xml file.
Furthermore, it is easy to insert debugging information into Python colorer control files.</li>
<li>It is easy to modify the Python colorer control files &#8216;by hand&#8217; without changing the corresponding xml file.
In particular, it would be easy to define entirely new kinds of pattern-matching rules in Python merely
by creating functions in a colorer control file.</li>
</ul>
</div>
<div class="section" id="the-colorizer-s-inner-loop">
<h2><a class="toc-backref" href="#id4">The colorizer&#8217;s inner loop</a><a class="headerlink" href="#the-colorizer-s-inner-loop" title="Permalink to this headline">¶</a></h2>
<p>When Leo&#8217;s syntax colorer sees the <a class="reference external" href="mailto:'&#37;&#52;&#48;language">'<span>&#64;</span>language</a> x&#8217; directive,
it will import x.py from Leo&#8217;s modes folder.
The colorer can then access any module-level object obj in x.py as x.obj.</p>
<p>Colorizer control files contain <strong>rules functions</strong> corresponding to rule elements in x.xml.
The colorizer can call these functions as if they were members of the colorizer class by
passing &#8216;self&#8217; as the first argument of these functions.
I call these rules <em>functions</em> to distinguish them from the corresponding
<strong>rules methods</strong> which are actual methods of the colorizer class.
Rules <em>functions</em> merely call corresponding rules <em>methods</em>.
Indeed, rules functions are simply a way of binding values to keyword arguments of rules methods.
These keywords arguments correspond to the xml attributes of rule elements in x.xml.</p>
<p>The colorizer calls rules functions until one matches, at which point a range of text gets colored and the process repeats.
The inner loop of the colorizer is this code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rulesDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],[]):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="n">n</span> <span class="p">;</span> <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<ul class="simple">
<li>rulesDict is a dictionary whose keys are rulesets and whose values are ruleset dictionaries.
Ruleset dictionaries have keys that are single characters and whose values are
the list of rules that can start with that character.</li>
<li>s is the full text to be colorized.</li>
<li>i is the position within s is to be colorized.</li>
</ul>
<p>Rules methods (and functions) return n &gt; 0 if they match, and n == 0 if they fail.</p>
</div>
<div class="section" id="format-of-colorizer-control-files">
<h2><a class="toc-backref" href="#id5">Format of colorizer control files</a><a class="headerlink" href="#format-of-colorizer-control-files" title="Permalink to this headline">¶</a></h2>
<p>The following sections describe the top-level data in x.py.</p>
<div class="section" id="ruleset-names">
<h3><a class="toc-backref" href="#id6">Ruleset names</a><a class="headerlink" href="#ruleset-names" title="Permalink to this headline">¶</a></h3>
<p>A <strong>ruleset name</strong> is a Python string having the form &#8216;x_setname&#8217;,
where setname is the value of the SET attribute of the &lt;RULES&gt; element in x.xml.
For example, the ruleset name of the ruleset whose SET attribute is JAVASCRIPT in php.xml is
&#8216;php_JAVASCRIPT&#8217;.
<strong>Important</strong>: by convention, the ruleset name of the default &lt;RULES&gt; element is &#8216;x_main&#8217;;
note that default &lt;RULES&gt; element have no SET attributes.</p>
<p>The colorizer uses ruleset names to gain access to all data structures in x.py.
To anticipate a bit, ruleset names are keys into two standard dictionaries,
x.rulesDict and x.keywordsDictDict,
from which the colorizer can get all other information in x.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># The rules list for the &#39;JAVASCRIPT&#39; ruleset in php.xml.</span>
<span class="n">rules</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rulesDict</span><span class="p">(</span><span class="s">&#39;php_JAVASCRIPT&#39;</span><span class="p">)</span>

<span class="c"># The keywords dict for the &#39;JAVASCRIPT&#39; ruleset in php.xml.</span>
<span class="n">keywordsDict</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">keywordsDictDict</span><span class="p">(</span><span class="s">&#39;php_JAVASCRIPT&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In fact, ruleset names (and x.rulesDict and x.keywordsDictDict)
are the <strong>only</strong> names that the colorizer needs to know in order to access all information in x.py.</p>
</div>
<div class="section" id="x-properties">
<h3><a class="toc-backref" href="#id7">x.properties</a><a class="headerlink" href="#x-properties" title="Permalink to this headline">¶</a></h3>
<p><strong>x.properties</strong> is a Python dictionary corresponding to the &lt;PROPS&gt; element in x.xml.
Keys are property names; values are strings, namely the contents of &lt;PROPERTY&gt; elements in x.xml.
x.properties contains properties for the entire mode.
That is, only modes have &lt;PROPS&gt; elements.
For example, here is x.properties in php.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># properties for mode php.xml</span>
<span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;commentEnd&quot;</span><span class="p">:</span> <span class="s">&quot;--&gt;&quot;</span><span class="p">,</span>
    <span class="s">&quot;commentStart&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;!--&quot;</span><span class="p">,</span>
    <span class="s">&quot;indentCloseBrackets&quot;</span><span class="p">:</span> <span class="s">&quot;}&quot;</span><span class="p">,</span>
    <span class="s">&quot;indentOpenBrackets&quot;</span><span class="p">:</span> <span class="s">&quot;{&quot;</span><span class="p">,</span>
    <span class="s">&quot;lineUpClosingBracket&quot;</span><span class="p">:</span> <span class="s">&quot;true&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="attribute-dictionaries-and-x-attributesdictdict">
<h3><a class="toc-backref" href="#id8">Attribute dictionaries and x.attributesDictDict</a><a class="headerlink" href="#attribute-dictionaries-and-x-attributesdictdict" title="Permalink to this headline">¶</a></h3>
<p>x.py contains a <strong>attribute dictionary</strong> for each ruleset in x.xml.
Keys are attribute names, values strings representing the values of the attributes.
This dictionary is empty if a ruleset contains no attributes.
The valid keys are:</p>
<ul class="simple">
<li>&#8216;default&#8217;: the default token type.  &#8216;null&#8217; is the default.</li>
<li>&#8216;digit_re&#8217;: a regular expression.
Words matching this regular expression are colored with the digit token type.</li>
<li>&#8216;ignore_case&#8217;: &#8216;true&#8217; or &#8216;false&#8217;.  Default is &#8216;true&#8217;.</li>
<li>&#8216;highlight_digits&#8217;: &#8216;true&#8217; or &#8216;false&#8217;.  Default is &#8216;true&#8217;.</li>
<li>&#8216;no_word_sep&#8217;: A list of characters treated as &#8216;alphabetic&#8217; characters when matching keywords.</li>
</ul>
<p>For example, here is one attribute dictionary in php.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Attributes dict for php_javascript ruleset.</span>
<span class="n">php_javascript_attributes_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;default&quot;</span><span class="p">:</span> <span class="s">&quot;MARKUP&quot;</span><span class="p">,</span>
    <span class="s">&quot;digit_re&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
    <span class="s">&quot;highlight_digits&quot;</span><span class="p">:</span> <span class="s">&quot;true&quot;</span><span class="p">,</span>
    <span class="s">&quot;ignore_case&quot;</span><span class="p">:</span> <span class="s">&quot;true&quot;</span><span class="p">,</span>
    <span class="s">&quot;no_word_sep&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>x.py also contains <strong>x.attributesDictDict</strong>.
Keys are ruleset names, values are attribute dictionaries.
Here is attributesDictDict for php.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Dictionary of attributes dictionaries for php mode.</span>
<span class="n">attributesDictDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;php_javascript&quot;</span><span class="p">:</span> <span class="n">php_javascript_attributes_dict</span><span class="p">,</span>
    <span class="s">&quot;php_javascript_php&quot;</span><span class="p">:</span> <span class="n">php_javascript_php_attributes_dict</span><span class="p">,</span>
    <span class="s">&quot;php_main&quot;</span><span class="p">:</span> <span class="n">php_main_attributes_dict</span><span class="p">,</span>
    <span class="s">&quot;php_php&quot;</span><span class="p">:</span> <span class="n">php_php_attributes_dict</span><span class="p">,</span>
    <span class="s">&quot;php_php_literal&quot;</span><span class="p">:</span> <span class="n">php_php_literal_attributes_dict</span><span class="p">,</span>
    <span class="s">&quot;php_phpdoc&quot;</span><span class="p">:</span> <span class="n">php_phpdoc_attributes_dict</span><span class="p">,</span>
    <span class="s">&quot;php_tags&quot;</span><span class="p">:</span> <span class="n">php_tags_attributes_dict</span><span class="p">,</span>
    <span class="s">&quot;php_tags_literal&quot;</span><span class="p">:</span> <span class="n">php_tags_literal_attributes_dict</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Note</strong>:
The jEdit2Py script creates &#8216;friendly&#8217; names for attribute dictionaries <em>solely</em> as an aid for people reading the code.
Leo&#8217;s colorer uses only the name x.attributeDictDict;
Leo&#8217;s colorer never uses the actual names of attribute dictionaries.</p>
</div>
<div class="section" id="keyword-dictionaries-and-x-keywordsdictdict">
<h3><a class="toc-backref" href="#id9">Keyword dictionaries and x.keywordsDictDict</a><a class="headerlink" href="#keyword-dictionaries-and-x-keywordsdictdict" title="Permalink to this headline">¶</a></h3>
<p>x.py contains a <strong>keyword dictionary</strong> for each ruleset in x.xml.
x.py contains an empty keywords dictionary if a ruleset contains no &lt;KEYWORDS&gt; element.</p>
<p>Keys are strings representing keywords of the language describe by the mode.
Values are strings representing syntactic categories,
i.e. a TYPE attribute valid in x.xml, namely:
COMMENT1, COMMENT2, COMMENT3, COMMENT4,
FUNCTION,
KEYWORD1, KEYWORD2, KEYWORD3, KEYWORD4,
LABEL, LITERAL1, LITERAL2, LITERAL3, LITERAL4,
MARKUP, NULL and OPERATOR.</p>
<p>For example, here (parts of) some keyword dictionaries in php.py:</p>
<div class="highlight-python"><pre># Keywords dict for mode php::PHP
php_PHP_keywords_dict = {
    "COM_invoke": "keyword2",
    "COM_load": "keyword2",
    "__CLASS__": "keyword3",
    ...
    "abs": "keyword2",
    "abstract": "keyword1",
    "accept_connect": "keyword2",
    ...
}

# Keywords dict for mode php::JAVASCRIPT_PHP
php_JAVASCRIPT_PHP_keywords_dict = {}

# Keywords dict for mode php::PHPDOC
php_PHPDOC_keywords_dict = {
    "@abstract": "label",
    "@access": "label",
    "@author": "label",
    ...
    "@var": "label",
    "@version": "label",
}</pre>
</div>
<p>x.py also contains <strong>x.keywordsDictDict</strong>.
Keys are ruleset names, values are keywords dictionaries.
Here is keywordsDictDict for php.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Dictionary of keywords dictionaries for php mode.</span>
<span class="n">keywordsDictDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;php_javascript&quot;</span><span class="p">:</span> <span class="n">php_javascript_keywords_dict</span><span class="p">,</span>
    <span class="s">&quot;php_javascript_php&quot;</span><span class="p">:</span> <span class="n">php_javascript_php_keywords_dict</span><span class="p">,</span>
    <span class="s">&quot;php_main&quot;</span><span class="p">:</span> <span class="n">php_main_keywords_dict</span><span class="p">,</span>
    <span class="s">&quot;php_php&quot;</span><span class="p">:</span> <span class="n">php_php_keywords_dict</span><span class="p">,</span>
    <span class="s">&quot;php_php_literal&quot;</span><span class="p">:</span> <span class="n">php_php_literal_keywords_dict</span><span class="p">,</span>
    <span class="s">&quot;php_phpdoc&quot;</span><span class="p">:</span> <span class="n">php_phpdoc_keywords_dict</span><span class="p">,</span>
    <span class="s">&quot;php_tags&quot;</span><span class="p">:</span> <span class="n">php_tags_keywords_dict</span><span class="p">,</span>
    <span class="s">&quot;php_tags_literal&quot;</span><span class="p">:</span> <span class="n">php_tags_literal_keywords_dict</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The colorizer can get the keywords dictionary for a ruleset as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">keywordsDict</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">keywordsDictDict</span><span class="p">(</span><span class="n">rulesetName</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Note</strong>:
The jEdit2Py script creates &#8216;friendly&#8217; names for keyword dictionaries <em>solely</em> as an aid for people reading the code.
Leo&#8217;s colorer uses only the name x.keywordsDictDict;
Leo&#8217;s colorer never uses the actual names of keywords dictionaries such as php_PHPDOC_keywords_dict.</p>
</div>
<div class="section" id="rules-rules-dictionaries-and-x-rulesdictdict">
<h3><a class="toc-backref" href="#id10">Rules, rules dictionaries and x.rulesDictDict</a><a class="headerlink" href="#rules-rules-dictionaries-and-x-rulesdictdict" title="Permalink to this headline">¶</a></h3>
<p>x.py contains one <strong>rule function</strong> for every rule in every ruleset (&lt;RULES&gt; element) in x.xml.
These rules have names rule1 through  ruleN,
where N is the total number of rules in all rulesets in x.xml.</p>
<p>Each rules <em>function</em> merely calls a rules <em>method</em> in Leo&#8217;s colorizer.
Which method gets called depends on the corresponding element in <cite>x.xml</cite>.
For example, the first rule in php.xml is:</p>
<div class="highlight-python"><pre>&lt;SPAN TYPE="MARKUP" DELEGATE="PHP"&gt;
            &lt;BEGIN&gt;&amp;lt;?php&lt;/BEGIN&gt;
            &lt;END&gt;?&amp;gt;&lt;/END&gt;
    &lt;/SPAN&gt;</pre>
</div>
<p>and the corresponding rule function is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">php_rule0</span><span class="p">(</span><span class="n">colorer</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">colorer</span><span class="o">.</span><span class="n">match_span</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&quot;markup&quot;</span><span class="p">,</span> <span class="n">begin</span><span class="o">=</span><span class="s">&quot;&lt;?php&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&quot;?&gt;&quot;</span><span class="p">,</span>
        <span class="n">at_line_start</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">at_whitespace_end</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">at_word_start</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">delegate</span><span class="o">=</span><span class="s">&quot;PHP&quot;</span><span class="p">,</span><span class="n">exclude_match</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">no_escape</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">no_line_break</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">no_word_break</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>php_rule0 calls colorer.match_span because the corresponding xml rule is a &lt;SPAN&gt; element.</p>
<p>For each ruleset, x.py also contains a <strong>rules dictionary</strong>,
a Python dictionary whose keys are characters and whose values are all lists
of rules functions that that can match the key.
For example:</p>
<div class="highlight-python"><pre># Rules dict for phpdoc ruleset.
rulesDict8 = {
    "*": [rule64,],
    "0": [rule70,],
    "1": [rule70,],
    "2": [rule70,],
    "3": [rule70,],
    "4": [rule70,],
    "5": [rule70,],
    "6": [rule70,],
    "7": [rule70,],
    "8": [rule70,],
    "9": [rule70,],
    "&lt;": [rule65,rule66,rule67,rule68,rule69,],
    "@": [rule70,],
    "A": [rule70,],
    "B": [rule70,],
    ...
    "X": [rule70,],
    "Y": [rule70,],
    "Z": [rule70,],
    "_": [rule70,],
    "a": [rule70,],
    "b": [rule70,],
   ...
    "x": [rule70,],
    "y": [rule70,],
    "z": [rule70,],
    "{": [rule63,],
}</pre>
</div>
<p><strong>Note</strong>: The order of rules in each rules list is important;
it should be the same as rules element in x.xml.</p>
<p>Finally, x.py contains <strong>x.rulesDictDict</strong>.
Keys are ruleset names, values are rules dictionaries.
The colorer can get the rules list for character ch as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">rulesDict</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rulesDictDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rulesetName</span><span class="p">)</span> <span class="c"># When a mode is inited.</span>
<span class="o">...</span>
<span class="n">rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rulesDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ch</span><span class="p">,[])</span> <span class="c"># In the main loop.</span>
</pre></div>
</div>
<p>For example, here is the rules dictionary for php.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># x.rulesDictDict for php mode.</span>
<span class="n">rulesDictDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;php_javascript&quot;</span><span class="p">:</span> <span class="n">rulesDict6</span><span class="p">,</span>
    <span class="s">&quot;php_javascript_php&quot;</span><span class="p">:</span> <span class="n">rulesDict7</span><span class="p">,</span>
    <span class="s">&quot;php_main&quot;</span><span class="p">:</span> <span class="n">rulesDict1</span><span class="p">,</span>
    <span class="s">&quot;php_php&quot;</span><span class="p">:</span> <span class="n">rulesDict4</span><span class="p">,</span>
    <span class="s">&quot;php_php_literal&quot;</span><span class="p">:</span> <span class="n">rulesDict5</span><span class="p">,</span>
    <span class="s">&quot;php_phpdoc&quot;</span><span class="p">:</span> <span class="n">rulesDict8</span><span class="p">,</span>
    <span class="s">&quot;php_tags&quot;</span><span class="p">:</span> <span class="n">rulesDict2</span><span class="p">,</span>
    <span class="s">&quot;php_tags_literal&quot;</span><span class="p">:</span> <span class="n">rulesDict3</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Note</strong>:
The jEdit2Py script creates &#8216;friendly&#8217; names for rules lists <em>solely</em> as an aid for people reading the code.
Leo&#8217;s colorer uses only the name x.rulesDictDict;
Leo&#8217;s colorer never uses the actual names of rules lists such as rulesDict8,
and Leo&#8217;s colorer never uses the actual names of rules functions such as rule64.</p>
</div>
<div class="section" id="x-importdict-and-imported-versus-delegated-rulesets">
<h3><a class="toc-backref" href="#id11">x.importDict and imported versus delegated rulesets</a><a class="headerlink" href="#x-importdict-and-imported-versus-delegated-rulesets" title="Permalink to this headline">¶</a></h3>
<p>x.importDict is a Python dictionary.
Keys are ruleset names; values are a list of ruleset names.
For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Import dict for php mode.</span>
<span class="n">importDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;php_javascript_php&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;javascript::main&quot;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For any ruleset R whose ruleset name is N, x.importDict.get(N)
is the list of rulesets names whose rulesets appear in
a DELEGATE attribute of an &lt;IMPORT&gt; rule element in R&#8217;s ruleset.
Such <strong>imported</strong> ruleset are copied to the end of the R&#8217;s rules list.
Leo&#8217;s colorizer does this copying only once, when loading ruleset R for the first time.</p>
<p><strong>Note 1</strong>: Loading imported rulesets must be done at &#8216;run time&#8217;.
It should definitely not be done by jEdit2Py at &#8216;compile time&#8217;;
that would require running jEdit2Py on <em>all</em> .xml files whenever any such file changed.</p>
<p><strong>Note 2</strong>:  Multiple &lt;IMPORT&gt; rule elements in a single ruleset are allowed:
delegated rules are copied to the end of N&#8217;s rules list in the order they appear in the ruleset.</p>
<p><strong>Note 3</strong>: The DELEGATE attribute of &lt;IMPORT&gt; elements is, in fact,
completely separate from the DELEGATE attributes of other rules as
discussed in <a class="reference internal" href="#arguments-to-rule-methods">Arguments to rule methods</a>.
Indeed, the DELEGATE attribute of &lt;IMPORT&gt; elements creates entries in
x.importDict, which in turn causes the colorizer to append the rules of the imported ruleset
to the end of the present rules list.
In contrast, the DELEGATE attributes of other rules sets the delegate argument to rules methods,
which in tern causes the colorizer to recursively color the matched text with the <strong>delegated</strong> ruleset.
In short:</p>
<ul class="simple">
<li>The rules of <strong>imported</strong> rulesets are appended to the end of another rules list;
the rules of <strong>delegated</strong> rulesets never are.</li>
<li><strong>Imported</strong> ruleset names appear as the values of items in x.importDict;
<strong>delegated</strong> ruleset names appear as delegate arguments to rule methods.</li>
</ul>
</div>
</div>
<div class="section" id="rule-methods">
<h2><a class="toc-backref" href="#id12">Rule methods</a><a class="headerlink" href="#rule-methods" title="Permalink to this headline">¶</a></h2>
<p>This section describes each rules method in Leo&#8217;s new colorizer.
Rules methods are called by rules functions in colorizer control file;
they correspond directly to rules elements in jEdit&#8217;s language description files.
In fact, this documentation is a &#8216;refactoring&#8217; of <a class="reference external" href="http://www.jedit.org/42docs/users-guide/writing-modes-part.html">jEdit&#8217;s documentation</a>.</p>
<p>All rule methods attempt to match a pattern at a particular spot in a string.
These methods all return True if the match succeeds.</p>
<div class="section" id="arguments-to-rule-methods">
<h3><a class="toc-backref" href="#id13">Arguments to rule methods</a><a class="headerlink" href="#arguments-to-rule-methods" title="Permalink to this headline">¶</a></h3>
<p>All rule methods take three required arguments and zero or more optional keyword arguments.</p>
<p>Here is a list of the required arguments and their meaning:</p>
<ul class="simple">
<li><strong>self</strong>: An instance of Leo&#8217;s colorizer.</li>
<li><strong>s</strong>: The string in which matches may be found.</li>
<li><strong>i</strong>: The location within the string at which the rule method looks for a match.</li>
</ul>
<p>Here is a list of all optional keyword arguments and their meaning:</p>
<ul class="simple">
<li><strong>at_line_start</strong>:
If True, a match will succeed only if i is at the start of a line.</li>
<li><strong>at_whitespace_end</strong>:
If True, the match will succeed only if i is at the first non-whitespace text in a line.</li>
<li><strong>at_word_start</strong>:
If True, the match will succeed only if i is at the beginning of a word.</li>
<li><strong>delegate</strong>:
If non-empty, the value of this argument is a <a class="reference internal" href="#ruleset-names">ruleset name</a>.
If the match succeeds, the matched text will be colored recursively with the indicate ruleset.</li>
<li><strong>exclude_match</strong>:
If True, the actual text that matched will not be colored.
The meaning of this argument varies slightly depending on whether one or two sequences are matched.
See the individual rule methods for details.</li>
<li><strong>kind</strong>: A string representing a class of tokens, i.e., one of:
&#8216;comment1&#8217;, &#8216;comment2&#8217;, &#8216;comment3&#8217;, &#8216;comment4&#8217;, &#8216;function&#8217;,
&#8216;keyword1&#8217;, &#8216;keyword2&#8217;, &#8216;keyword3&#8217;, &#8216;keyword4&#8217;,
&#8216;label&#8217;, &#8216;literal1&#8217;, &#8216;literal2&#8217;, &#8216;literal3&#8217;, &#8216;literal4&#8217;,
&#8216;markup&#8217;, &#8216;null&#8217; and &#8216;operator&#8217;.</li>
<li><strong>no_escape</strong>:
If True, the ruleset&#8217;s escape character will have no effect before the end argument to match_span.
Otherwise, the presence of the escape character will cause that occurrence of the end string to be ignored.</li>
<li><strong>no_line_break</strong>:
If True, the match will not succeed across line breaks.</li>
<li><strong>no_word_break</strong>:
If True, the match will not cross word breaks.</li>
</ul>
<p>New in Leo 4.4.1 final: the regular expression rule matchers no longer get a hash_char argument
because such matchers are called only if the present search pattern starts with hash_char.</p>
</div>
<div class="section" id="match-eol-span">
<h3><a class="toc-backref" href="#id14">match_eol_span</a><a class="headerlink" href="#match-eol-span" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>def match_eol_span (self,s,i,kind,begin,
    at_line_start = False,
    at_whitespace_end = False,
    at_word_start = False,
    delegate = '',
    exclude_match = False):</pre>
</div>
<p>match_eol_span succeeds if s[i:].startswith(begin) and
the at_line_start, at_whitespace_end and at_word_start conditions are all satisfied.</p>
<p>If successful, match_eol_span highlights from i to the end of the line
with the color specified by kind.
If the exclude_match argument is True, only the text before the matched text will be colored.
The delegate argument, if present, specifies the ruleset to color the colored text.</p>
</div>
<div class="section" id="match-eol-span-regexp">
<h3><a class="toc-backref" href="#id15">match_eol_span_regexp</a><a class="headerlink" href="#match-eol-span-regexp" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>def match_eol_span_regexp (self,s,i,kind,regex,
    at_line_start = False,
    at_whitespace_end = False,
    at_word_start = False,
    delegate = '',
    exclude_match = False):</pre>
</div>
<p>match_eol_span_exp succeeds if:</p>
<ol class="arabic simple">
<li>The regular expression regex matches at s[i:], and</li>
<li>The at_line_start, at_whitespace_end and at_word_start conditions are all satisfied.</li>
</ol>
<p>If successful, match_eol_span_regexp  highlights from i to the end of the line.
If the exclude_match argument is True, only the text before the matched text will be colored.
The delegate argument, if present, specifies the ruleset to color the colored text.</p>
</div>
<div class="section" id="match-keywords">
<h3><a class="toc-backref" href="#id16">match_keywords</a><a class="headerlink" href="#match-keywords" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>def match_keywords (self,s,i):</pre>
</div>
<p>match_keywords succeeds if s[i:] starts with an identifier contained in the mode&#8217;s keywords dictionary d.</p>
<p>If successful, match_keywords colors the keyword.
match_keywords does not take a kind keyword argument.
Instead, the keyword is colored as specified by d.get(theKeyword).</p>
</div>
<div class="section" id="match-mark-following">
<h3><a class="toc-backref" href="#id17">match_mark_following</a><a class="headerlink" href="#match-mark-following" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>def match_mark_following (self,s,i,kind,pattern,
    at_line_start = False,
    at_whitespace_end = False,
    at_word_start = False,
    exclude_match = False):</pre>
</div>
<p>match_mark_following succeeds if s[i:].startswith(pattern), and
the at_line_start, at_whitespace_end and at_word_start conditions are all satisfied.</p>
<p>If successful, match_mark_following colors from i to the start of the next token
with the color specified by kind.
If the exclude_match argument is True, only the text after the matched text will be colored.</p>
</div>
<div class="section" id="match-mark-previous">
<h3><a class="toc-backref" href="#id18">match_mark_previous</a><a class="headerlink" href="#match-mark-previous" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>def match_mark_previous (self,s,i,kind,pattern,
    at_line_start = False,
    at_whitespace_end = False,
    at_word_start = False,
    exclude_match = False):</pre>
</div>
<p>match_mark_previous succeeds if s[i:].startswith(pattern),and
the at_line_start, at_whitespace_end and at_word_start conditions are all satisfied.</p>
<p>If successful, match_mark_previous colors from the end of the previous token to i
with the color specified by kind.
If the exclude_match argument is True, only the text before the matched text will be colored.</p>
</div>
<div class="section" id="match-seq">
<h3><a class="toc-backref" href="#id19">match_seq</a><a class="headerlink" href="#match-seq" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>def match_seq (self,s,i,kind,seq,
    at_line_start = False,
    at_whitespace_end = False,
    at_word_start = False,
    delegate = ''):</pre>
</div>
<p>match_seq succeeds if s[i:].startswith(seq) and
the at_line_start, at_whitespace_end and at_word_start conditions are all satisfied.</p>
<p>If successful, match_seq highlights from i to the end of the sequence
with the color specified by kind.
The delegate argument, if present, specifies the ruleset to color the colored text.</p>
</div>
<div class="section" id="match-seq-regexp">
<h3><a class="toc-backref" href="#id20">match_seq_regexp</a><a class="headerlink" href="#match-seq-regexp" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>def match_seq_regexp (self,s,i,kind,regex,
    at_line_start = False,
    at_whitespace_end = False,
    at_word_start = False,
    delegate = ''):</pre>
</div>
<p>match_seq succeeds if:</p>
<ol class="arabic simple">
<li>The regular expression regex matches at s[i:], and</li>
<li>The at_line_start, at_whitespace_end and at_word_start conditions are all satisfied.</li>
</ol>
<p>If successful, match_seq_regexp highlights from i to the end of the sequence
with the color specified by kind.
The delegate argument, if present, specifies the ruleset to color the colored text.</p>
</div>
<div class="section" id="match-span">
<h3><a class="toc-backref" href="#id21">match_span</a><a class="headerlink" href="#match-span" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>def match_span (self,s,i,kind,begin,end,
    at_line_start = False,
    at_whitespace_end = False,
    at_word_start = False,
    exclude_match = False,
    delegate = ''
    no_escape = False,
    no_line_break = False,
    no_word_break = False):</pre>
</div>
<p>match_span succeeds if there is an index j &gt; i such that
s[:i].startswith(begin) and s[i:j].endswith(end) and the
at_line_start, at_whitespace_end, at_word_start,
no_escape, no_line_break and no_word_break conditions are all satisfied.</p>
<p>If successful, match_span highlights from s[i:j
with the color specified by kind;
but if the exclude_match argument is True, the begin and end text are not colored.
The delegate argument, if present, specifies the ruleset to color the colored text.</p>
</div>
<div class="section" id="match-span-regexp">
<h3><a class="toc-backref" href="#id22">match_span_regexp</a><a class="headerlink" href="#match-span-regexp" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>def match_span (self,s,i,kind,regex,end,
    at_line_start = False,
    at_whitespace_end = False,
    at_word_start = False,
    exclude_match = False,
    delegate = ''
    no_escape = False,
    no_line_break = False,
    no_word_break = False):</pre>
</div>
<p>match_span_regex succeeds if:</p>
<ol class="arabic simple">
<li>The regular expression regex matches at s[i:],</li>
<li>There is an index j &gt; i such that s[i:j].endswith(end),</li>
<li>The at_line_start, at_whitespace_end, at_word_start,
no_escape, no_line_break and no_word_break conditions are all satisfied.</li>
</ol>
<p>If successful, match_span colors s[i:j],
with the color specified by kind;
but if the exclude_match argument is True, the begin and end text are not colored.
The delegate argument, if present, specifies the ruleset to color the colored text.</p>
</div>
<div class="section" id="match-terminate">
<h3><a class="toc-backref" href="#id23">match_terminate</a><a class="headerlink" href="#match-terminate" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>def match_terminate (self,s,i,kind,at_char):</pre>
</div>
<p>match_terminate succeeds if s[i:] contains at least at_char more characters.</p>
<p>If successful, match_terminate colors at_char characters
with the color specified by kind.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="leo_toc.html">
              <img class="logo" src="_static/Leo4-80-border.jpg" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="customizing.html"
                        title="previous chapter">Customizing Leo</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="rstplugin3.html"
                        title="next chapter">Creating Documents with Leo</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="rstplugin3.html" title="Creating Documents with Leo"
             >next</a> |</li>
        <li class="right" >
          <a href="customizing.html" title="Customizing Leo"
             >previous</a> |</li>
        <li><a href="leo_toc.html">Leo v4.9 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Edward K. Ream.
      Last updated on Oct 28, 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>