

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Customizing Leo &mdash; Leo v4.9 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '4.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <link rel="top" title="Leo v4.9 documentation" href="index.html" />
    <link rel="next" title="Controlling Syntax Coloring" href="coloring.html" />
    <link rel="prev" title="Using Leo’s Commands" href="commands.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="coloring.html" title="Controlling Syntax Coloring"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="commands.html" title="Using Leo’s Commands"
             accesskey="P">previous</a> |</li>
        <li><a href="leo_toc.html">Leo v4.9 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="customizing-leo">
<h1><a class="toc-backref" href="#id2">Customizing Leo</a><a class="headerlink" href="#customizing-leo" title="Permalink to this headline">¶</a></h1>
<p>This chapter discusses how to customize Leo using the plugins and other means.
See <a class="reference external" href="commands.html#specifying-settings">Specifying settings</a> for a description of how to change Leo&#8217;s settings.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#customizing-leo" id="id2">Customizing Leo</a><ul>
<li><a class="reference internal" href="#id1" id="id3">Specifying settings</a><ul>
<li><a class="reference internal" href="#configuration-directories" id="id4">Configuration directories</a></li>
<li><a class="reference internal" href="#search-order-for-settings-files" id="id5">Search order for settings files</a></li>
<li><a class="reference internal" href="#safe-rules-for-local-settings" id="id6">Safe rules for local settings</a></li>
<li><a class="reference internal" href="#organizer-nodes" id="id7">Organizer nodes</a></li>
<li><a class="reference internal" href="#ignore-and-if-nodes" id="id8">&#64;ignore and &#64;if nodes</a></li>
<li><a class="reference internal" href="#simple-settings-nodes" id="id9">Simple settings nodes</a></li>
<li><a class="reference internal" href="#complex-settings-nodes" id="id10">Complex settings nodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#input-modes" id="id11">Input modes</a></li>
<li><a class="reference internal" href="#adding-extensible-attributes-to-nodes-and-leo-files" id="id12">Adding extensible attributes to nodes and .leo files</a></li>
<li><a class="reference internal" href="#translating-leo-s-menus-and-messages" id="id13">Translating Leo&#8217;s menus and messages</a></li>
<li><a class="reference internal" href="#writing-new-importers" id="id14">Writing new importers</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id3">Specifying settings</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Leo stores options in <strong>&#64;settings trees</strong>, outlines whose headline is
&#64;settings. When opening a .leo file, Leo looks for &#64;settings trees not only
in the outline being opened but also in various leoSettings.leo files.
This scheme allows for the following kinds of settings:</p>
<ul class="simple">
<li>Per-installation or per-machine settings.</li>
<li>Per-user settings.</li>
<li>Per-folder settings.</li>
<li>Per-file settings.</li>
</ul>
<p>There are four kinds of settings files:</p>
<ol class="arabic simple">
<li><strong>Default settings files</strong>, named <strong>leoSettings.leo</strong>.
Although they can be used in other ways, they typically contain default settings.</li>
<li><strong>Personal settings files</strong>, named <strong>myLeoSettings.leo</strong>. They provide a way
of ensuring that your customized settings are not altered when updating Leo
from bzr or while installing a new version of Leo. The myLeoSettings.leo acts
much like Python&#8217;s site-customize.py file. myLeoSettings.leo will never be
part of any Leo distribution, and it will never exist in Leo&#8217;s cvs
repository. This solution is <em>much</em> better than trying to update
leoSettings.leo with scripts.</li>
<li><strong>Machine settings files</strong>, named <strong>LeoSettings.leo</strong> (note the capital &#8216;L&#8217;),
and appearing in a unique directory.</li>
<li><strong>Command-line settings files</strong>, specified using Leo&#8217;s -c command-line
option. Any .leo file may be used, provided it has an &#64;settings tree. These
files typically provide a common set of settings for files scattered in
various places on the file system.</li>
</ol>
<p>The following sections describe the kinds of nodes in &#64;settings trees.</p>
<div class="section" id="configuration-directories">
<h3><a class="toc-backref" href="#id4">Configuration directories</a><a class="headerlink" href="#configuration-directories" title="Permalink to this headline">¶</a></h3>
<p>Settings files can be found in the following directories:</p>
<ul class="simple">
<li><strong>homeDir</strong>, the HOME/.leo directory. HOME is given by Python&#8217;s HOME
environment variable, or by os.expanduser(&#8216;~&#8217;) if no HOME environment variable
exists.</li>
<li><strong>configDir</strong>, Leo&#8217;s configuration directory: leo/config.</li>
<li><strong>machineDir</strong>, the HOME/.leo/MACHINE directory. MACHINE is given by Python&#8217;s
HOSTNAME environment variable, or by Python&#8217;s COMPUTERNAME environment
variable if there is no HOSTNAME variable, or by the value returned by
socket.gethostname() if neither environment variable exists.</li>
<li><strong>localDir</strong>, the directory containing the .leo file being loaded.</li>
</ul>
<p>In addition, Leo&#8217;s -c command-line option can specify any .leo file anywhere.</p>
</div>
<div class="section" id="search-order-for-settings-files">
<h3><a class="toc-backref" href="#id5">Search order for settings files</a><a class="headerlink" href="#search-order-for-settings-files" title="Permalink to this headline">¶</a></h3>
<p>When reading a .leo file, Leo looks for settings in default settings
files first, then settings in personal settings files, and finally
settings in local settings files.  The exact search order is:</p>
<ol class="arabic simple">
<li>Default settings files:<ol class="loweralpha">
<li>configDir/leoSettings.leo</li>
<li>homeDir/leoSettings.leo</li>
<li>localDir/leoSettings.leo</li>
</ol>
</li>
<li>Personal settings files:<ol class="loweralpha">
<li>configDir/myLeoSettings.leo</li>
<li>homeDir/myLeoSettings.leo</li>
<li>homeDir/&lt;machine-name&gt;LeoSettings.leo (note capitalization)</li>
<li>localDir/myLeoSettings.leo</li>
</ol>
</li>
<li>Local settings files:<ol class="loweralpha">
<li>The file specified by the -c command-line option.</li>
<li>The file being loaded.</li>
</ol>
</li>
</ol>
<p>Settings that appear later in this list override settings that
appear earlier in this list.  This happens on a setting-by-setting
basis, <em>not</em> on a file-by-file basis.  In other words, each individual
setting overrides only the <em>corresponding</em> setting in previously-read
files.  Reading a setting file does <em>not</em> reset all previous settings.
Note that the same file might appear several times in the search list.
Leo detects such duplicate file names and only loads each settings file once.
Leo remembers all the settings in settings files and does not reread those
settings when reading another .leo file.</p>
<p><strong>Caution</strong>: This search order offers almost too much flexibility. This can be
confusing, even for power users. It&#8217;s important to choose the &#8220;simplest
configuration scheme that could possibly work&#8221;.  Something like:</p>
<ul class="simple">
<li>Use a single leoSettings.leo file for installation-wide defaults.</li>
<li>Use a single myLeoSettings.leo files for personal defaults.</li>
<li>Use local settings sparingly.</li>
</ul>
<p><strong>Important</strong>: it is good style to limit settings placed in
myLeoSettings.leo to those settings that differ from default settings.</p>
</div>
<div class="section" id="safe-rules-for-local-settings">
<h3><a class="toc-backref" href="#id6">Safe rules for local settings</a><a class="headerlink" href="#safe-rules-for-local-settings" title="Permalink to this headline">¶</a></h3>
<p>You should use special care when placing default or personal settings files in
<strong>local</strong> directories, that is, directories other than homeDir, configDir or
machineDir. In particular, the value of localDir can change when Leo reads
additional files. This can result in Leo finding new default and personal
settings files. The values of these newly-read settings files will, as always,
override any previously-read settings.</p>
<p>Let us say that a setting is <strong>volatile</strong> if it is different from a default
setting. Let us say that settings file A.leo <strong>covers</strong> settings file if B.leo
if all volatile settings in B.leo occur in A.leo. With these definitions, the
<strong>safe rule</strong> for placing settings files in local directories is:</p>
<div class="highlight-python"><pre>Settings files in local directories should
cover all other settings files.</pre>
</div>
<p>Following this rule will ensure that the per-directory defaults specified in the
local settings file will take precedence over all previously-read default and
personal settings files. Ignore this principle at your peril.</p>
</div>
<div class="section" id="organizer-nodes">
<h3><a class="toc-backref" href="#id7">Organizer nodes</a><a class="headerlink" href="#organizer-nodes" title="Permalink to this headline">¶</a></h3>
<p>Organizer nodes have headlines that do no start with &#64;.
Organizer nodes may be inserted freely without changing the meaning of an &#64;setting tree.</p>
</div>
<div class="section" id="ignore-and-if-nodes">
<h3><a class="toc-backref" href="#id8">&#64;ignore and &#64;if nodes</a><a class="headerlink" href="#ignore-and-if-nodes" title="Permalink to this headline">¶</a></h3>
<p>Leo ignores any subtree of an &#64;settings tree whose headline starts with &#64;ignore.</p>
<p>You can use several other kinds of nodes to cause Leo to ignore parts of  an &#64;settings tree:</p>
<ul>
<li><p class="first">&#64;if <em>expression</em></p>
<p>A node whose headline starts with &#64;if <em>expression</em> acts like an organizer node if the expression evaluates to True,
otherwise acts like an &#64;ignore node.
If the expression is empty the body text should contain a script that will be evaluated (in an empty context).</p>
</li>
<li><p class="first">&#64;ifplatform <em>platform-name</em></p>
<p>Same as &#64;if sys.platform == &#8220;platform-name&#8221;: except that it isn&#8217;t necessary to import sys.</p>
</li>
<li><p class="first">&#64;ifhostname <em>hostA,!hostB</em></p>
<p>Evaluates to True if and only if: h=g.computeMachineName(); h==hostA and h!=hostB.
The &#8221;!&#8221; version allows matching to every machine name except the given one
to allow differing settings on only a few machines.</p>
</li>
</ul>
</div>
<div class="section" id="simple-settings-nodes">
<h3><a class="toc-backref" href="#id9">Simple settings nodes</a><a class="headerlink" href="#simple-settings-nodes" title="Permalink to this headline">¶</a></h3>
<p>Simple settings nodes have headlines of the form:</p>
<div class="highlight-python"><pre>@&lt;type&gt; name = val</pre>
</div>
<p>set the value of name to val, with the indicated type.</p>
<p>&lt;type&gt; may be one of the following:</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr><td>&lt;type&gt;</td>
<td>Valid values</td>
</tr>
<tr><td>&#64;bool</td>
<td>True, False, 0, 1</td>
</tr>
<tr><td>&#64;color</td>
<td>A Tk color name or value, such as &#8216;red&#8217; or &#8216;xf2fddff&#8217; (without the quotes)</td>
</tr>
<tr><td>&#64;directory</td>
<td>A path to a directory</td>
</tr>
<tr><td>&#64;float</td>
<td>A floating point number of the form nn.ff.</td>
</tr>
<tr><td>&#64;int</td>
<td>An integer</td>
</tr>
<tr><td>&#64;ints[list]</td>
<td>An integer (must be one of the ints in the list).
Example: &#64;ints meaningOfLife[0,42,666]=42</td>
</tr>
<tr><td>&#64;keys[name]</td>
<td>Gives a name to a set of bindings for the Check Bindings script in leoSettings.leo.</td>
</tr>
<tr><td>&#64;path</td>
<td>A path to a directory or file</td>
</tr>
<tr><td>&#64;ratio</td>
<td>A floating point number between 0.0 and 1.0, inclusive.</td>
</tr>
<tr><td>&#64;string</td>
<td>A string</td>
</tr>
<tr><td>&#64;strings[list]</td>
<td>A string (must be one of the strings in the list).
Example: &#64;strings tk_relief[&#8216;flat&#8217;,&#8217;groove&#8217;,&#8217;raised&#8217;]=&#8217;groove&#8217;</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: For a list of Tk color specifiers see:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.tcl.tk/man/tcl8.4/TkCmd/colors.htm">http://www.tcl.tk/man/tcl8.4/TkCmd/colors.htm</a></li>
<li><a class="reference external" href="http://www.tcl.tk/man/tcl8.4/TkLib/GetColor.htm">http://www.tcl.tk/man/tcl8.4/TkLib/GetColor.htm</a></li>
</ul>
<p><strong>Important</strong>: you can use the show-colors minibuffer command to guide you in making these settings.</p>
</div>
<div class="section" id="complex-settings-nodes">
<h3><a class="toc-backref" href="#id10">Complex settings nodes</a><a class="headerlink" href="#complex-settings-nodes" title="Permalink to this headline">¶</a></h3>
<p>Complex settings nodes have headlines of the form:</p>
<div class="highlight-python"><pre>@&lt;type&gt; description</pre>
</div>
<p>The type may be one of the following:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr><td>&lt;type&gt;</td>
<td>Valid values</td>
</tr>
<tr><td>&#64;buttons</td>
<td>Child &#64;button nodes create global buttons</td>
</tr>
<tr><td>&#64;commands</td>
<td>Child &#64;command nodes create global buttons</td>
</tr>
<tr><td>&#64;data</td>
<td>Body text contains a list of strings, one per line.</td>
</tr>
<tr><td>&#64;enabled-plugins</td>
<td>Body text contains a list of enabled plugins</td>
</tr>
<tr><td>&#64;font</td>
<td>Body text contains a font description</td>
</tr>
<tr><td>&#64;menus</td>
<td>Child &#64;menu and &#64;item nodes create menus and menu items.</td>
</tr>
<tr><td>&#64;menuat</td>
<td>Child &#64;menu and &#64;item nodes modify menu tree create by &#64;menus.</td>
</tr>
<tr><td>&#64;mode [name]</td>
<td>Body text contains a list of shortcut specifiers.</td>
</tr>
<tr><td>&#64;recentfiles</td>
<td>Body text contains a list of file paths.</td>
</tr>
<tr><td>&#64;shortcuts</td>
<td>Body text contains a list of shortcut specifies.</td>
</tr>
</tbody>
</table>
<p>Complex nodes specify settings in their body text.
See the following sections for details.</p>
<div class="section" id="button">
<h4>&#64;button<a class="headerlink" href="#button" title="Permalink to this headline">¶</a></h4>
<p>An &#64;buttons tree in a settings file defines global buttons that
are created in the icon area of all .leo files.
All &#64;button nodes in the &#64;commands tree create global buttons.
All &#64;button nodes outside the commands tree create buttons local to the settings file.</p>
</div>
<div class="section" id="commands">
<h4>&#64;commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h4>
<p>An &#64;commands tree in a settings file defines global commands.
All &#64;command nodes in the &#64;commands tree create global commands.
All &#64;command nodes outside the commands tree create commands local to the settings file.</p>
</div>
<div class="section" id="data">
<h4>&#64;data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h4>
<p>The body text contains a list of strings, one per line.
Lines starting with &#8216;#&#8217; are ignored.</p>
</div>
<div class="section" id="enabled-plugins">
<h4>&#64;enabled-plugins<a class="headerlink" href="#enabled-plugins" title="Permalink to this headline">¶</a></h4>
<p>The body text of the &#64;enabled plugins node contains a list of enabled plugins,
one per line. Comment lines starting with &#8216;#&#8217; are ignored. Leo loads plugins in
the order they appear.
<strong>Important</strong>: Leo handles &#64;enabled-plugins nodes a differently from other kinds
of settings. To avoid confusion, <strong>please read the following carefully</strong>.</p>
<p>As always, Leo looks for &#64;enabled-plugins nodes in settings files in the order
specified by <a class="reference internal" href="#search-order-for-settings-files">Search order for settings files</a>. Leo will enable all plugins
found in the &#64;enabled-plugins node it finds <em>last</em> in the search order. Leo does
<em>not</em> enable plugins found in any other &#64;enabled-plugins node. In particular,
<strong>you can not specify a list of default plugins by placing that list in a
settings file that appears early in the search list</strong>. Instead, the last
&#64;enabled-plugins node found in the search list specifies all and <em>only</em> the plugins
that will be enabled.</p>
<p>Let us distinguish two different situations. First, what Leo does when loading a
file, say x.leo. Second, what Leo does when loading a second file, say y.leo,
<em>from x.leo</em>. When loading the first .leo file, Leo enables plugins from the
&#64;enabled-plugins node it finds <em>last</em> in the search order. But after plugins
have <em>already</em> been loaded and enabled, there is no way to disable previously
loaded-and-enabled plugins. But local settings files can enable additional
plugins.</p>
<p>To avoid confusion, I highly recommend following another kind of safe rule.
We say that an &#64;enabled-plugin node in file A.leo <strong>covers</strong> an &#64;enabled-plugin
node in file B.leo if all plugins specified in B&#8217;s &#64;enabled-plugin node appear
A&#8217;s &#64;enabled-plugin node. The safe rule for plugins is:</p>
<div class="highlight-python"><pre>@enabled-plugin nodes in settings files in local directories
should cover @enabled-plugins nodes in all other settings files.</pre>
</div>
</div>
<div class="section" id="font">
<h4>&#64;font<a class="headerlink" href="#font" title="Permalink to this headline">¶</a></h4>
<p>The body text contains a list of settings for a font.  For example:</p>
<div class="highlight-python"><pre>body_text_font_family = Courier New
body_text_font_size = None
body_text_font_slant = None
body_text_font_weight = None</pre>
</div>
<p><strong>Important</strong>: you can use the show-fonts minibuffer command to guide you in making these settings.</p>
</div>
<div class="section" id="menuat">
<h4>&#64;menuat<a class="headerlink" href="#menuat" title="Permalink to this headline">¶</a></h4>
<p>The form of this node is:</p>
<div class="highlight-python"><pre>@menuat *&lt;path&gt;* *&lt;action&gt;* *[clipboard]*</pre>
</div>
<p>The &#64;menuat setting has 2-3 parameters in its head text, its children are &#64;menu and
&#64;item nodes as for the &#64;menu setting.  &#64;menuat modifies the menu tree created by &#64;menus.
It is intended to be used in myLeoSettings.leo to modify the menu tree created
in leoSettings.leo. This allows you to change the menus without having to
re-create the entire menu tree from leoSettings.leo, and ensures you don&#8217;t miss
out when new things are added in the &#64;menus in leoSettings.leo, as you would if
you replaced the &#64;menus in leoSettings.leo with one in myLeoSettings.leo.
&#64;menuat should occur in a &#64;settings tree, but not as a descendant of a &#64;menus
tree. There is an example of the use of the
&#64;menuat setting in the file .../leo/core/test/menuAtTest.leo.</p>
<p>The <strong>path</strong> argument specifies a target location in the menu tree as defined by
&#64;menus and modified by earlier &#64;menuat settings. The path takes the form
/entry1/entry2/entry3 where each entry is the name of a menu or item with all
text except a-z and 0-9 removed. Upper case letters are converted to lower case.
So for example to use the <cite>Outline-&gt;Move-&gt;Move Down</cite> menu item as a target, you
would specify a path as <cite>/outline/move/movedown</cite>.</p>
<p>The <strong>action</strong> argument specifies what the menu item does.
There are 5 available actions:</p>
<ul class="simple">
<li><strong>before</strong>: The supplied items and sub menus will be inserted immediately
before the target menu or item.</li>
<li><strong>after</strong>: The supplied items and sub menus will be inserted immediately after
the target menu or item.</li>
<li><strong>append</strong>: The supplied items and sub menus will be appended at the end of
the menu containing the target menu or item.</li>
<li><strong>cut</strong>: The target menu or item will be removed from the menu tree and saved
to an internal clipboard. This can be used for deleting menus or items.
Descendants of the &#64;menuat setting are ignored.</li>
<li><strong>copy</strong>: The target menu or item will be copied and saved to
an internal clipboard.  Descendants of the &#64;menuat setting are ignored.</li>
</ul>
<p>The optional <strong>clipboard</strong> argument modifies the action of the before, after,
and append actions. By default these actions insert the menus and items supplied
as descendants of the &#64;menuat setting. If you specify &#8220;clipboard&#8221; (without the
quotes) as the source, the contents of the clipboard from a previous cut or copy
action will be used instead. This parameter is optional and can be left blank.</p>
</div>
<div class="section" id="menus">
<h4>&#64;menus<a class="headerlink" href="#menus" title="Permalink to this headline">¶</a></h4>
<p>Leo creates its menus from the &#64;menu, &#64;item and &#64;popup nodes in the &#64;menus tree.
Within &#64;menus trees, &#64;menu nodes create menus and &#64;item nodes create menu items.</p>
<p>The menu name always follows &#64;menu. If the menu name is &#8216;Plugins&#8217;, Leo will
create the Plugins menu and populate the menu by calling the
&#8216;create-optional-menus&#8217; hook. This creates the Plugins menu as usual. Nested
&#64;menu nodes define submenus.</p>
<p>The command name follows &#64;item. If the body text of an &#64;item node exists, this
body text is the menu name. Otherwise, the menu name is the command name.
However, if the command name starts with a &#8216;*&#8217;, hyphens are removed from the
menu name. Menu names and command names may contain a single ampersand (&amp;). If
present, the following character is underlined in the name. If the command
name in an &#64;item node is just a hyphen (-), the item represents a menu
separator.</p>
<p>&#64;popup <em>&lt;widget-name&gt;</em> creates a popup menu for use by the rClick plugin.
The children of this node should be &#64;menu and &#64;item nodes, used as with
&#64;menus.</p>
</div>
<div class="section" id="mode">
<h4>&#64;mode<a class="headerlink" href="#mode" title="Permalink to this headline">¶</a></h4>
<p>The form of this node is:</p>
<div class="highlight-python"><pre>@mode *&lt;mode name&gt;*</pre>
</div>
<p>The body text contains a list of shortcut specifiers. &#64;mode nodes work just
like &#64;shortcuts nodes, but in addition they have the side effect of creating
the enter-&lt;mode name&gt;-mode command.</p>
</div>
<div class="section" id="recentfiles">
<h4>&#64;recentfiles<a class="headerlink" href="#recentfiles" title="Permalink to this headline">¶</a></h4>
<p>The body text contains a list of paths of recently opened files, one path per
line. Leo writes the list of recent files to .leoRecentFiles.txt in Leo&#8217;s
config directory, again one file per line.</p>
</div>
<div class="section" id="shortcuts">
<h4>&#64;shortcuts<a class="headerlink" href="#shortcuts" title="Permalink to this headline">¶</a></h4>
<p>The body text contains a list of shortcut specifiers.</p>
</div>
</div>
</div>
<div class="section" id="input-modes">
<h2><a class="toc-backref" href="#id11">Input modes</a><a class="headerlink" href="#input-modes" title="Permalink to this headline">¶</a></h2>
<p>Leo now allows you to specify input modes. You enter mode x with the
enter-x-mode command. The purpose of a mode is to create different bindings
for keys within a mode. Often plain keys are useful in input modes.</p>
<p>You can specify modes with &#64;mode nodes in leoSettings.leo. &#64;mode nodes work
just like &#64;shortcuts nodes, but in addition they have the side effect of
creating the enter-&lt;mode name&gt;-mode command.</p>
<p>Notes:</p>
<ul class="simple">
<li>You can exit any mode using the keyboard-quit (Control-g) command. This is the
<strong>only</strong> binding that is automatically created in each mode. All other bindings
must be specified in the &#64;mode node. In particular, the bindings specified in
&#64;shortcuts nodes are <strong>not</strong> in effect in mode (again, except for the
keyboard-quit binding).</li>
<li>Leo supports something akin to tab completion within modes: if you type a key
that isn&#8217;t bound in a mode a &#8216;Mode&#8217; tab will appear in the log pane. This tab
shows all the keys that you can type and the commands to which they are bound.
The mode-help command does the same thing.</li>
<li>&#64;shortcuts nodes specify the bindings for what might be called the &#8216;top-level&#8217;
mode. These are the bindings in effect when no internal state is present, for
example, just after executing the keyboard-quit command.</li>
<li>The top_level_unbound_key_action setting determines what happens to
unbound keys in the top-level mode. Leo ignores unbound keys in all other modes.
The possibilities are &#8216;insert&#8217;, &#8216;replace&#8217; and &#8216;ignore&#8217;.</li>
<li>The set-insert-mode, set-overwrite-mode and set-ignore-mode
commands alter what happens to unbound keys in the top-level mode.</li>
</ul>
<p>With all these options it should be possible to emulate the keyboard behavior of any other editor.</p>
</div>
<div class="section" id="adding-extensible-attributes-to-nodes-and-leo-files">
<h2><a class="toc-backref" href="#id12">Adding extensible attributes to nodes and .leo files</a><a class="headerlink" href="#adding-extensible-attributes-to-nodes-and-leo-files" title="Permalink to this headline">¶</a></h2>
<p>Leo&#8217;s .leo file format is extensible.
The basis for extending .leo files are the v.unknownAttributes ivars of vnodes,
uA&#8217;s for short.
Leo translates between uA&#8217;s and xml attributes in the corresponding
&lt;v&gt; elements in .leo files.
Plugins may also use v.tempAttributes ivars to hold temporary information
that will <em>not</em> be written to the .leo file.
These two ivars are called <strong>attribute ivars</strong>.</p>
<p>Attribute ivars must be Python dictionaries, whose keys are names of plugins and
whose values are <em>other</em> dictionaries, called <strong>inner dictionaries</strong>, for
exclusive use of each plugin.</p>
<p>The v.u Python property allows plugins to get and set v.unknownAttributes easily:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">d</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">u</span> <span class="c"># gets uA (the outer dict) for v</span>
<span class="n">v</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">d</span> <span class="c"># sets uA (the outer dict) for v</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python"><pre>plugin_name = 'xyzzy'
d = v.u # Get the outer dict.
inner_d = d.get(plugin_name,{}) # Get the inner dict.
inner_d ['duration']= 5
inner_d ['notes'] "This is a note."
d [plugin_name] = inner_d
v.u = d</pre>
</div>
<p>No corresponding Python properties exist for v.tempAttributes,
so the corresponding example would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plugin_name</span> <span class="o">=</span> <span class="s">&#39;xyzzy&#39;</span>
<span class="c"># Get the outer dict.</span>
<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="p">,</span><span class="s">&#39;tempAttributes&#39;</span><span class="p">):</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">tempAttributes</span>
<span class="k">else</span><span class="p">:</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">inner_d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">,{})</span> <span class="c"># Get the inner dict.</span>
<span class="n">inner_d</span> <span class="p">[</span><span class="s">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">inner_d</span> <span class="p">[</span><span class="s">&#39;notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;This is a note.&quot;</span>
<span class="n">d</span> <span class="p">[</span><span class="n">plugin_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">inner_d</span>
<span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">tempAttributes</span> <span class="o">=</span> <span class="n">d</span>
</pre></div>
</div>
<p><strong>Important</strong>: All members of inner dictionaries should be picklable: Leo
uses Python&#8217;s Pickle module to encode all values in these dictionaries. Leo will
discard any attributes that can not be pickled. This should not be a major
problem to plugins. For example, instead of putting a tnode into these
dictionaries, a plugin could put the tnode&#8217;s gnx (a string) in the dictionary.</p>
<p><strong>Note</strong>: Leo does <em>not</em> pickle members of inner dictionaries whose name (key) starts with str_.
The values of such members should be a Python string.
This convention allows strings to appear in .leo files in a more readable format.</p>
<p>Here is how Leo associates uA&#8217;s with &lt;v&gt; elements in .leo files:</p>
<ul class="simple">
<li><strong>Native xml attributes</strong> are the attributes of &lt;v&gt; elements that are
known (treated specially) by Leo&#8217;s read/write code. The native attributes of
&lt;v&gt; elements are a, t, vtag, tnodeList, marks,
expanded and descendentTnodeUnknownAttributes. All other attributes of
&lt;v&gt; and &lt;t&gt; elements are <strong>foreign xml attributes</strong>.</li>
<li>When reading a .leo file, Leo will create v.unknownAttributes ivars for
any vnode whose corresponding &lt;v&gt; or &lt;t&gt; element contains a
foreign xml attribute.</li>
<li>When writing a file, Leo will write foreign xml attributes in &lt;v&gt; elements
if the corresponding vnode contains an unknownAttributes ivar.</li>
<li>Leo performs the usual xml escapes on these strings when reading or writing
the unknownAttributes ivars.</li>
</ul>
</div>
<div class="section" id="translating-leo-s-menus-and-messages">
<h2><a class="toc-backref" href="#id13">Translating Leo&#8217;s menus and messages</a><a class="headerlink" href="#translating-leo-s-menus-and-messages" title="Permalink to this headline">¶</a></h2>
<p>It is easy to translate Leo&#8217;s menu strings: simply create an &#64;menus tree in
leoSettings.leo or myLeoSettings.leo that contains the translated menu names.</p>
<p><strong>New in Leo 4.4.8</strong>:
Leo now contains support for translating messages sent to Leo&#8217;s log:</p>
<ul class="simple">
<li>Rather than using an &#8216;_&#8217; function to denote strings to be translated, Leo&#8217;s
g.es and g.es_print functions translate &#8220;odd&#8221; (first, third, fifth) arguments,
leaving &#8220;even&#8221; arguments untranslated. Keyword arguments, color, newline, etc.
are never translated.</li>
<li>All calls to g.es and g.es_print in Leo&#8217;s core follow this convention.</li>
<li>g.translateString does the actual translation using Python&#8217;s <a class="reference external" href="http://docs.python.org/lib/module-gettext.html">gettext</a> module.</li>
<li>You can use the script in the node &#8220;&#64;button print g.es stats&#8221; in scripts.leo
to create catalogs of all scripts that need to be translated. Such catalogs
are used by Python&#8217;s gettext module. (This script was also used to check that
the proper arguments to g.es and g.es_print were translated.)</li>
</ul>
</div>
<div class="section" id="writing-new-importers">
<h2><a class="toc-backref" href="#id14">Writing new importers</a><a class="headerlink" href="#writing-new-importers" title="Permalink to this headline">¶</a></h2>
<p>This section describes the process of creating an importer for a new language.
There are a set of &#8220;importers&#8221; in leoImport.py, all based on the
baseScannerClass class. You can define your own importer by creating a subclass.
This shouldn&#8217;t be too difficult: baseScannerClass is supposed to do almost all
the work. With luck, your subclass might be very simple, as with class cScanner.</p>
<p><strong>Important</strong> As I write this, I realize that I remember very little about the
code, but I do remember its general organization and the process of creating a
new importer. The following should be all you need to write any importer.</p>
<p>This base class has three main parts:</p>
<ol class="arabic simple">
<li>The &#8220;parser&#8221; that recognizes where nodes begin and end.</li>
<li>The &#8220;code generator&#8221; the actually creates the imported nodes.</li>
<li>Checking code that ensures that the imported code is equivalent
to the original code.</li>
</ol>
<p>You should never have to change the code generators or the checking code.
Confine your attention to the parser.</p>
<p>The parser thinks it is looking for classes, and within classes,
method definitions.  Your job is to tell the parser how to do this.
Let&#8217;s look at part of the ctor for baseScannerClass for clues:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># May be overridden in subclasses.</span>
<span class="bp">self</span><span class="o">.</span><span class="n">anonymousClasses</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># For Delphi Pascal interfaces.</span>
<span class="bp">self</span><span class="o">.</span><span class="n">blockCommentDelim1</span> <span class="o">=</span> <span class="bp">None</span>
<span class="bp">self</span><span class="o">.</span><span class="n">blockCommentDelim2</span> <span class="o">=</span> <span class="bp">None</span>
<span class="bp">self</span><span class="o">.</span><span class="n">blockCommentDelim1_2</span> <span class="o">=</span> <span class="bp">None</span>
<span class="bp">self</span><span class="o">.</span><span class="n">blockCommentDelim2_2</span> <span class="o">=</span> <span class="bp">None</span>
<span class="bp">self</span><span class="o">.</span><span class="n">blockDelim1</span> <span class="o">=</span> <span class="s">&#39;{&#39;</span>
<span class="bp">self</span><span class="o">.</span><span class="n">blockDelim2</span> <span class="o">=</span> <span class="s">&#39;}&#39;</span>
<span class="bp">self</span><span class="o">.</span><span class="n">blockDelim2Cruft</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Stuff that can follow .blockDelim2.</span>
<span class="bp">self</span><span class="o">.</span><span class="n">classTags</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;class&#39;</span><span class="p">,]</span> <span class="c"># tags that start a tag.</span>
<span class="bp">self</span><span class="o">.</span><span class="n">functionTags</span> <span class="o">=</span> <span class="p">[]</span>
<span class="bp">self</span><span class="o">.</span><span class="n">hasClasses</span> <span class="o">=</span> <span class="bp">True</span>
<span class="bp">self</span><span class="o">.</span><span class="n">hasFunctions</span> <span class="o">=</span> <span class="bp">True</span>
<span class="bp">self</span><span class="o">.</span><span class="n">lineCommentDelim</span> <span class="o">=</span> <span class="bp">None</span>
<span class="bp">self</span><span class="o">.</span><span class="n">lineCommentDelim2</span> <span class="o">=</span> <span class="bp">None</span>
<span class="bp">self</span><span class="o">.</span><span class="n">outerBlockDelim1</span> <span class="o">=</span> <span class="bp">None</span>
<span class="bp">self</span><span class="o">.</span><span class="n">outerBlockDelim2</span> <span class="o">=</span> <span class="bp">None</span>
<span class="bp">self</span><span class="o">.</span><span class="n">outerBlockEndsDecls</span> <span class="o">=</span> <span class="bp">True</span>
<span class="bp">self</span><span class="o">.</span><span class="n">sigHeadExtraTokens</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Extra tokens valid in head of signature.</span>
<span class="bp">self</span><span class="o">.</span><span class="n">sigFailTokens</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># A list of strings that abort a signature when seen in a tail.</span>
    <span class="c"># For example, &#39;;&#39; and &#39;=&#39; in C.</span>
<span class="bp">self</span><span class="o">.</span><span class="n">strict</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># True if leading whitespace is very significant.</span>
</pre></div>
</div>
<p>Naturally, this looks like gibberish at first. I do <em>not</em> remember what all
these things do in detail, although obviously the names mean something. What I
<em>do</em> remember is that these ivars control the operation of the startsFunction
and startsClass methods and their helpers (especially startsHelper) and
the methods that call them, scan and scanHelper. Most of these methods have a
trace var that will enable tracing during importing.</p>
<p>So the strategy is simple: study startsHelper in detail, set the ivars above to
make startsHelper do what you want, and trace until things work as you want.</p>
<p>There is one more detail. Sometimes the ivars above are not sufficient to get
the job done. In that case, subclasses will override various methods of the
parser, but <em>not</em> the code generator. If indentation is important, you will want
to look at the Python importer. Notice that it overrides skipCodeBlock, called
by startsHelper.</p>
<p>That&#8217;s about it. It would be pointless to give you more details, because those
details would lead you <em>away</em> from the process you need to follow. Having said
that, feel free to ask further questions. I&#8217;ll be glad to answer them.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="leo_toc.html">
              <img class="logo" src="_static/Leo4-80-border.jpg" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="commands.html"
                        title="previous chapter">Using Leo&#8217;s Commands</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="coloring.html"
                        title="next chapter">Controlling Syntax Coloring</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="coloring.html" title="Controlling Syntax Coloring"
             >next</a> |</li>
        <li class="right" >
          <a href="commands.html" title="Using Leo’s Commands"
             >previous</a> |</li>
        <li><a href="leo_toc.html">Leo v4.9 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Edward K. Ream.
      Last updated on Oct 31, 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>